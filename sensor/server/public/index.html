<!DOCTYPE html>
<html lang="en">
<head>
	<title>HFS Sensor Dashboard</title>
	<style>
        img {
            height: 100vh;
            width: auto;
        }
		th, td {
			padding: 10px;
			text-align: center;
			vertical-align: middle;
		}
      </style>
	<script>
		function updateImage() {
			console.log("updateImage");
			var images = document.getElementsByTagName('img');
			for (var i = 0; i < images.length; i++) {
				var dt = new Date();
				var img = images[i];
			  const url = new URL(img.src);
			  url.search = 'time=' + dt.getTime();
			  img.src = url.href;
			}
		}
		function updateData() {
			console.log('updateData');
			var table = document.getElementById('data-table');
			table.innerHTML='';
			$.getJSON('http://' + ip + ':3000/api/db?id=0&limit=20', function(data) {
				data.forEach(function(row_data) {
					let row = document.createElement('tr');
					let time = document.createElement('td');
					let id = document.createElement('td');
					let d = document.createElement('td');
					let chlf_r = document.createElement('td');
					let chlf_n = document.createElement('td');
					let f = document.createElement('td');
					time.innerHTML = row_data['timestamp'];
					id.innerHTML = row_data['id'];
					d.innerHTML = row_data['distance'];
					chlf_r.innerHTML = row_data['chlf_raw'];
					chlf_n.innerHTML = row_data['chlf_normal'];
					f.innerHTML = row_data['f_factor'];
					row.appendChild(time);
					row.appendChild(id);
					row.appendChild(d);
					row.appendChild(chlf_r);
					row.appendChild(chlf_n);
					row.appendChild(f);
					table.appendChild(row);   
				})
			});
			
		}
		setInterval(function() {
			console.log("interval");
			updateImage();
			updateData();
		}, 10000);
	</script>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<meta name="description" content="" />
</head>
<body style="margin:0; padding:0;">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
  <div class="container" style="text-align:center;"> 
	<img src = "http://" + ip + ":3000/api/file/flourescence_factor_data.jpg" id="cycle">
	<script>
		var image = document.getElementById('cycle');
		var clicks = 0;
		image.addEventListener('click', function(){
			clicks = clicks + 1;
			console.log('click')
			var ip = location.host;
			if (clicks > 2) clicks = 0;
			if (clicks === 0) image.src = 'http://' + ip + ':3000/api/file/flourescence_factor_data.jpg';
			if (clicks === 1) image.src = 'http://' + ip + ':3000/api/file/normalized_flourescence_data.jpg';
			if (clicks === 2) image.src = 'http://' + ip + ':3000/api/file/raw_flourescence_data.jpg';
		});
	</script>
  </div>
  <table style="margin-left:auto; margin-right:auto;">
	<thead>
		<tr>
			<th style="padding-right:70px; padding-left:70px;">Timestamp</th>
			<th>Sensor ID</th>
			<th>Distance (m)</th>
			<th>Raw Flourescence (FU)</th>
			<th>Normalized Flourescence (%)</th>
			<th>Flourescence Factor</th>
		</tr>
	</thead>
	<tbody id="data-table"></tbody>
	<script>updateData();</script>
	</table>
</body>
</html>