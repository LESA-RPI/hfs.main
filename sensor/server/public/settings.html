<!DOCTYPE html>
<html lang="en">
<head>
	<title>HFS Dashboard</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<meta name="description" content="" />
	<script>
		function sendCmdOverBLE(device_addr, cmd, data) {
			fetch('http://' + location.host + '/api/ble', {
				method: 'POST',
				body: JSON.stringify({
					addr: device_addr,
					cmd: parseInt(cmd),
					data: parseInt(data)
				}),
				headers: {
					"Content-type": "application/json; charset=UTF-8"
				}
			});
		}
		function getDevices() {
			fetch('http://' + location.host + '/api/ble', {
				method: 'POST',
				body: JSON.stringify({ addr: "", cmd: 3, data: 0 }),
				headers: {
					"Content-type": "application/json; charset=UTF-8"
				}
			})
				.then((response) => response.json())
				.then((data) => {
					let dropdown = document.getElementById('option-sensors');
					dropdown.innerHTML = ''
					let options = [];
					let option = document.createElement('option');
					console.log(data);
					data.devices.forEach(function (device) {
						let device_json = JSON.parse(device)
						option.text = device_json['name'];
						option.value = device_json['address'];
						options.push(option.outerHTML);
					});
					dropdown.insertAdjacentHTML('beforeEnd', options.join('\n'));
					// todo: update the other dropdown values with what the device settings currently display
				});
			
			
		}
		function updateDevice(cmd, value_id) {
			let address = document.getElementById('option-sensors').value;
			let data = document.getElementById(value_id).value;
			if (address == null) { return; }
			sendCmdOverBLE(address, cmd, data);
		}
		getDevices();
	</script>
</head>
<body style="margin:0; padding:0;">

	
	<hr class="rounded">
	
	<table style="padding-left:20%;padding-top:20px;width:80%;text-align:left">
		<thead>
			<tr>
				<td>
					<label for="option-sensors" style="padding-right:20px">Device</label>
					<select name="option-sensors" id="option-sensors" onclick="getDevices()"></select>
				</td>
			</tr>

			<tr>
				<td>
					<label for="option-program" style="padding-right:20px">Program</label>
					<select name="option-program" id="option-program" onchange="updateDevice(2, 'option-program')">
						<option value=10>default (v1.0)</option>
						<option value=11>distance testing</option>
						<option value=12>farfield testing</option>
						<option value=13>flash testing</option>
						<option value=14>frequency testing</option>
						<option value=15>noise testing</option>
					</select>
				</td>
			</tr>
			
			<tr>
				<td>


				</td>
			</tr>
		</thead>
	<tbody id="settings-table"></tbody>
	</table>
</body>
</html>